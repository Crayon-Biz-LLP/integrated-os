name: Trial Beta Pulse Cron
on:
  schedule:
    # Runs every hour at minute 30 UTC (Top of the hour in IST)
    - cron: '30 * * * *'
  workflow_dispatch:  # Manual test button

jobs:
  pulse:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
    - name: Trigger Beta Vercel Pulse
      run: |
        # Check if the trigger was a manual button click
        if [ "${{ github.event_name }}" == "workflow_dispatch" ]; then
          echo "Manual dispatch detected: Sending override header to BETA endpoint."
          RESPONSE=$(curl -s -w "HTTP: %{http_code}" -X POST \
            https://chief-three.vercel.app/api/pulse \
            -H "x-pulse-secret: ${{ secrets.TRIAL_PULSE_SECRET }}" \
            -H "x-manual-trigger: true")
        else
          echo "Scheduled cron detected: Respecting time locks for BETA endpoint."
          RESPONSE=$(curl -s -w "HTTP: %{http_code}" -X POST \
            https://chief-three.vercel.app/api/pulse \
            -H "x-pulse-secret: ${{ secrets.TRIAL_PULSE_SECRET }}")
        fi
        
        echo "Response: $RESPONSE"
      env:
        CURL_CA_BUNDLE: ""